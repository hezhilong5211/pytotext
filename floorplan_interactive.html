<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高级交互式平面图 - 支持滚轮缩放</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft YaHei", sans-serif;
            background: #1a1a2e;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 顶部工具栏 */
        .toolbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .toolbar h1 {
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toolbar-right {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .zoom-info {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 10px 40px 10px 16px;
            border: none;
            border-radius: 25px;
            width: 250px;
            font-size: 14px;
            outline: none;
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .search-box input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .search-box button {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.3);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            color: white;
            font-size: 16px;
        }

        /* 主内容区 */
        .main-wrapper {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #0f3460;
        }

        /* SVG容器 */
        #viewport {
            width: 100%;
            height: 100%;
            cursor: grab;
            position: relative;
        }

        #viewport.dragging {
            cursor: grabbing;
        }

        #floorplan {
            width: 100%;
            height: 100%;
            transition: none;
        }

        .room {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .room:hover {
            filter: brightness(1.2) drop-shadow(0 0 8px rgba(255,255,255,0.5));
            stroke: #ffd700;
            stroke-width: 3;
        }

        .room.highlight {
            animation: pulse 1.5s ease-in-out infinite;
            stroke: #ff6b6b;
            stroke-width: 4;
        }

        @keyframes pulse {
            0%, 100% { 
                filter: brightness(1.2) drop-shadow(0 0 15px rgba(255,107,107,0.8));
            }
            50% { 
                filter: brightness(1.5) drop-shadow(0 0 25px rgba(255,107,107,1));
            }
        }

        .room-label {
            pointer-events: none;
            font-weight: 600;
            fill: #222;
        }

        /* 控制面板 */
        .control-panel {
            position: absolute;
            right: 24px;
            bottom: 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
        }

        .control-btn {
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            font-weight: bold;
        }

        .control-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(102,126,234,0.6);
            border-color: rgba(255,255,255,0.6);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        /* 小地图 */
        .minimap {
            position: absolute;
            bottom: 24px;
            left: 24px;
            width: 220px;
            height: 150px;
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            overflow: hidden;
            border: 3px solid rgba(102,126,234,0.5);
        }

        .minimap svg {
            width: 100%;
            height: 100%;
        }

        .minimap-viewport {
            fill: rgba(102,126,234,0.3);
            stroke: #667eea;
            stroke-width: 2;
            pointer-events: none;
        }

        /* 提示信息 */
        .tooltip {
            position: fixed;
            background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(30,30,60,0.95));
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 14px;
            pointer-events: none;
            z-index: 10000;
            display: none;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
            border: 2px solid rgba(102,126,234,0.5);
            min-width: 200px;
        }

        .tooltip.show {
            display: block;
            animation: tooltipFadeIn 0.2s ease;
        }

        @keyframes tooltipFadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tooltip .room-id {
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 18px;
            color: #ffd700;
        }

        .tooltip .room-info {
            color: #ddd;
            line-height: 1.5;
        }

        /* 详情弹窗 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: auto;
            animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        @keyframes slideUp {
            from { transform: translateY(100px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 28px 36px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }

        .modal-header h2 {
            font-size: 26px;
            font-weight: 700;
        }

        .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 28px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.35);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 36px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 28px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .info-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .info-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .info-value {
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        /* 帮助提示 */
        .help-panel {
            position: absolute;
            top: 24px;
            left: 24px;
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            max-width: 300px;
            border: 2px solid rgba(102,126,234,0.3);
        }

        .help-title {
            font-weight: 700;
            margin-bottom: 12px;
            color: #667eea;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 13px;
            color: #555;
        }

        .help-icon {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
        }

        .hide-help {
            margin-top: 12px;
            width: 100%;
            padding: 8px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .show-help-btn {
            position: absolute;
            top: 24px;
            left: 24px;
            background: rgba(102,126,234,0.9);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: none;
        }

        .show-help-btn:hover {
            background: rgba(102,126,234,1);
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .toolbar h1 {
                font-size: 18px;
            }
            .search-box input {
                width: 150px;
            }
            .minimap {
                width: 150px;
                height: 100px;
            }
            .help-panel {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 顶部工具栏 -->
        <div class="toolbar">
            <h1>
                <span>🏢</span>
                <span>智能平面图系统</span>
            </h1>
            <div class="toolbar-right">
                <div class="zoom-info" id="zoomInfo">100%</div>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="搜索房间..." onkeyup="searchRoom(event)">
                    <button onclick="performSearch()">🔍</button>
                </div>
            </div>
        </div>

        <!-- 主内容区 -->
        <div class="main-wrapper">
            <div id="viewport">
                <svg id="floorplan" viewBox="0 0 1400 900" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
                    <!-- 背景 -->
                    <defs>
                        <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
                            <path d="M 50 0 L 0 0 0 50" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                        </pattern>
                        <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e3f2fd;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#f3e5f5;stop-opacity:1" />
                        </linearGradient>
                        
                        <!-- 发光效果 -->
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    
                    <rect width="1400" height="900" fill="url(#bgGradient)" />
                    <rect width="1400" height="900" fill="url(#grid)" />

                    <!-- 建筑外轮廓 -->
                    <rect x="30" y="30" width="1340" height="840" fill="none" stroke="#555" stroke-width="6" rx="10"/>

                    <!-- 办公区域 - 左上 -->
                    <g class="room" data-room="S-001" onclick="showRoomDetail('S-001')">
                        <rect x="60" y="60" width="250" height="180" fill="#42a5f5" stroke="#1976d2" stroke-width="3" rx="8"/>
                        <text x="185" y="140" class="room-label" text-anchor="middle" font-size="18">S-001</text>
                        <text x="185" y="165" style="font-size: 13px; fill: #1565c0; font-weight: 500;" text-anchor="middle">办公室A</text>
                    </g>

                    <g class="room" data-room="S-002" onclick="showRoomDetail('S-002')">
                        <rect x="330" y="60" width="250" height="180" fill="#42a5f5" stroke="#1976d2" stroke-width="3" rx="8"/>
                        <text x="455" y="140" class="room-label" text-anchor="middle" font-size="18">S-002</text>
                        <text x="455" y="165" style="font-size: 13px; fill: #1565c0; font-weight: 500;" text-anchor="middle">办公室B</text>
                    </g>

                    <g class="room" data-room="S-003" onclick="showRoomDetail('S-003')">
                        <rect x="600" y="60" width="250" height="180" fill="#42a5f5" stroke="#1976d2" stroke-width="3" rx="8"/>
                        <text x="725" y="140" class="room-label" text-anchor="middle" font-size="18">S-003</text>
                        <text x="725" y="165" style="font-size: 13px; fill: #1565c0; font-weight: 500;" text-anchor="middle">办公室C</text>
                    </g>

                    <!-- 大会议室 -->
                    <g class="room" data-room="S-010" onclick="showRoomDetail('S-010')">
                        <rect x="60" y="260" width="400" height="250" fill="#66bb6a" stroke="#2e7d32" stroke-width="3" rx="8"/>
                        <text x="260" y="370" class="room-label" text-anchor="middle" font-size="22">S-010</text>
                        <text x="260" y="400" style="font-size: 15px; fill: #1b5e20; font-weight: 600;" text-anchor="middle">大会议室 (VIP)</text>
                        
                        <!-- 会议桌 -->
                        <ellipse cx="260" cy="340" rx="120" ry="60" fill="none" stroke="#1b5e20" stroke-width="3"/>
                        <circle cx="200" cy="320" r="8" fill="#1b5e20"/>
                        <circle cx="260" cy="300" r="8" fill="#1b5e20"/>
                        <circle cx="320" cy="320" r="8" fill="#1b5e20"/>
                        <circle cx="200" cy="380" r="8" fill="#1b5e20"/>
                        <circle cx="260" cy="400" r="8" fill="#1b5e20"/>
                        <circle cx="320" cy="380" r="8" fill="#1b5e20"/>
                    </g>

                    <!-- 小会议室 -->
                    <g class="room" data-room="S-011" onclick="showRoomDetail('S-011')">
                        <rect x="480" y="260" width="180" height="250" fill="#66bb6a" stroke="#2e7d32" stroke-width="3" rx="8"/>
                        <text x="570" y="370" class="room-label" text-anchor="middle" font-size="18">S-011</text>
                        <text x="570" y="395" style="font-size: 13px; fill: #1b5e20; font-weight: 500;" text-anchor="middle">小会议室</text>
                    </g>

                    <!-- 休息区 -->
                    <g class="room" data-room="S-100" onclick="showRoomDetail('S-100')">
                        <rect x="680" y="260" width="170" height="250" fill="#ab47bc" stroke="#6a1b9a" stroke-width="3" rx="8"/>
                        <text x="765" y="370" class="room-label" text-anchor="middle" font-size="18">S-100</text>
                        <text x="765" y="395" style="font-size: 13px; fill: #4a148c; font-weight: 500;" text-anchor="middle">休息区</text>
                        <text x="765" y="420" style="font-size: 28px;" text-anchor="middle">☕</text>
                    </g>

                    <!-- 功能区 - 右上 -->
                    <g class="room" data-room="S-020" onclick="showRoomDetail('S-020')">
                        <rect x="870" y="60" width="200" height="140" fill="#ef5350" stroke="#c62828" stroke-width="3" rx="8"/>
                        <text x="970" y="120" class="room-label" text-anchor="middle" font-size="18">S-020</text>
                        <text x="970" y="145" style="font-size: 13px; fill: #b71c1c; font-weight: 500;" text-anchor="middle">茶水间</text>
                        <text x="970" y="100" style="font-size: 26px;" text-anchor="middle">☕🍰</text>
                    </g>

                    <g class="room" data-room="S-021" onclick="showRoomDetail('S-021')">
                        <rect x="1090" y="60" width="150" height="140" fill="#ef5350" stroke="#c62828" stroke-width="3" rx="8"/>
                        <text x="1165" y="120" class="room-label" text-anchor="middle" font-size="18">S-021</text>
                        <text x="1165" y="145" style="font-size: 13px; fill: #b71c1c; font-weight: 500;" text-anchor="middle">卫生间</text>
                        <text x="1165" y="100" style="font-size: 26px;" text-anchor="middle">🚻</text>
                    </g>

                    <!-- 设备机房 -->
                    <g class="room" data-room="S-030" onclick="showRoomDetail('S-030')">
                        <rect x="870" y="220" width="370" height="180" fill="#ffa726" stroke="#e65100" stroke-width="3" rx="8"/>
                        <text x="1055" y="300" class="room-label" text-anchor="middle" font-size="18">S-030</text>
                        <text x="1055" y="325" style="font-size: 13px; fill: #bf360c; font-weight: 500;" text-anchor="middle">设备机房</text>
                        <text x="1055" y="280" style="font-size: 30px;" text-anchor="middle">⚙️🔧</text>
                    </g>

                    <!-- 走廊 -->
                    <rect x="60" y="530" width="1180" height="100" fill="#cfd8dc" stroke="#546e7a" stroke-width="2" stroke-dasharray="10,5" rx="8"/>
                    <text x="650" y="585" style="font-size: 18px; fill: #37474f; font-weight: 600;" text-anchor="middle">← 主走廊 MAIN CORRIDOR →</text>

                    <!-- 底部办公区 -->
                    <g class="room" data-room="S-201" onclick="showRoomDetail('S-201')">
                        <rect x="60" y="650" width="230" height="200" fill="#42a5f5" stroke="#1976d2" stroke-width="3" rx="8"/>
                        <text x="175" y="740" class="room-label" text-anchor="middle" font-size="18">S-201</text>
                        <text x="175" y="765" style="font-size: 13px; fill: #1565c0; font-weight: 500;" text-anchor="middle">开放办公区</text>
                    </g>

                    <g class="room" data-room="S-202" onclick="showRoomDetail('S-202')">
                        <rect x="310" y="650" width="230" height="200" fill="#42a5f5" stroke="#1976d2" stroke-width="3" rx="8"/>
                        <text x="425" y="740" class="room-label" text-anchor="middle" font-size="18">S-202</text>
                        <text x="425" y="765" style="font-size: 13px; fill: #1565c0; font-weight: 500;" text-anchor="middle">财务部</text>
                        <text x="425" y="720" style="font-size: 24px;" text-anchor="middle">💰</text>
                    </g>

                    <g class="room" data-room="S-203" onclick="showRoomDetail('S-203')">
                        <rect x="560" y="650" width="290" height="200" fill="#66bb6a" stroke="#2e7d32" stroke-width="3" rx="8"/>
                        <text x="705" y="740" class="room-label" text-anchor="middle" font-size="18">S-203</text>
                        <text x="705" y="765" style="font-size: 13px; fill: #1b5e20; font-weight: 500;" text-anchor="middle">培训室</text>
                        <text x="705" y="720" style="font-size: 24px;" text-anchor="middle">📚</text>
                    </g>

                    <g class="room" data-room="S-204" onclick="showRoomDetail('S-204')">
                        <rect x="870" y="650" width="370" height="200" fill="#ff7043" stroke="#bf360c" stroke-width="3" rx="8"/>
                        <text x="1055" y="740" class="room-label" text-anchor="middle" font-size="20">S-204</text>
                        <text x="1055" y="770" style="font-size: 14px; fill: #bf360c; font-weight: 600;" text-anchor="middle">总经理办公室</text>
                        <text x="1055" y="715" style="font-size: 30px;" text-anchor="middle">👔💼</text>
                    </g>

                    <!-- 门的标识 (红色) -->
                    <line x1="185" y1="240" x2="185" y2="260" stroke="#ff1744" stroke-width="8" stroke-linecap="round"/>
                    <line x1="455" y1="240" x2="455" y2="260" stroke="#ff1744" stroke-width="8" stroke-linecap="round"/>
                    <line x1="260" y1="510" x2="260" y2="530" stroke="#ff1744" stroke-width="8" stroke-linecap="round"/>
                    <line x1="570" y1="510" x2="570" y2="530" stroke="#ff1744" stroke-width="8" stroke-linecap="round"/>
                    
                    <!-- 安全出口 -->
                    <g filter="url(#glow)">
                        <rect x="1260" y="60" width="100" height="70" fill="#00c853" rx="8"/>
                        <text x="1310" y="100" style="font-size: 16px; fill: white; font-weight: bold;" text-anchor="middle">EXIT</text>
                        <text x="1310" y="82" style="font-size: 20px;" text-anchor="middle">🚪</text>
                    </g>
                    <g filter="url(#glow)">
                        <rect x="1260" y="770" width="100" height="70" fill="#00c853" rx="8"/>
                        <text x="1310" y="810" style="font-size: 16px; fill: white; font-weight: bold;" text-anchor="middle">EXIT</text>
                        <text x="1310" y="792" style="font-size: 20px;" text-anchor="middle">🚪</text>
                    </g>

                    <!-- 装饰元素 - 植物 -->
                    <text x="650" y="550" style="font-size: 30px;" text-anchor="middle">🌿</text>
                    <text x="750" y="550" style="font-size: 30px;" text-anchor="middle">🌿</text>
                </svg>
            </div>

            <!-- 帮助面板 -->
            <div class="help-panel" id="helpPanel">
                <div class="help-title">
                    <span>💡</span>
                    <span>操作指南</span>
                </div>
                <div class="help-item">
                    <span class="help-icon">鼠标滚轮</span>
                    <span>缩放视图</span>
                </div>
                <div class="help-item">
                    <span class="help-icon">拖拽</span>
                    <span>平移画布</span>
                </div>
                <div class="help-item">
                    <span class="help-icon">双击</span>
                    <span>快速放大</span>
                </div>
                <div class="help-item">
                    <span class="help-icon">点击房间</span>
                    <span>查看详情</span>
                </div>
                <div class="help-item">
                    <span class="help-icon">ESC</span>
                    <span>关闭弹窗</span>
                </div>
                <button class="hide-help" onclick="toggleHelp()">我知道了</button>
            </div>

            <button class="show-help-btn" id="showHelpBtn" onclick="toggleHelp()">
                💡 查看帮助
            </button>

            <!-- 小地图 -->
            <div class="minimap">
                <svg viewBox="0 0 1400 900" id="minimapSvg">
                    <rect width="1400" height="900" fill="#f0f0f0"/>
                    <rect x="30" y="30" width="1340" height="840" fill="none" stroke="#999" stroke-width="4"/>
                    
                    <!-- 简化的房间显示 -->
                    <rect x="60" y="60" width="250" height="180" fill="#42a5f5" opacity="0.7"/>
                    <rect x="330" y="60" width="250" height="180" fill="#42a5f5" opacity="0.7"/>
                    <rect x="600" y="60" width="250" height="180" fill="#42a5f5" opacity="0.7"/>
                    <rect x="60" y="260" width="400" height="250" fill="#66bb6a" opacity="0.7"/>
                    <rect x="480" y="260" width="180" height="250" fill="#66bb6a" opacity="0.7"/>
                    <rect x="680" y="260" width="170" height="250" fill="#ab47bc" opacity="0.7"/>
                    <rect x="870" y="60" width="200" height="140" fill="#ef5350" opacity="0.7"/>
                    <rect x="1090" y="60" width="150" height="140" fill="#ef5350" opacity="0.7"/>
                    <rect x="870" y="220" width="370" height="180" fill="#ffa726" opacity="0.7"/>
                    <rect x="60" y="650" width="230" height="200" fill="#42a5f5" opacity="0.7"/>
                    <rect x="310" y="650" width="230" height="200" fill="#42a5f5" opacity="0.7"/>
                    <rect x="560" y="650" width="290" height="200" fill="#66bb6a" opacity="0.7"/>
                    <rect x="870" y="650" width="370" height="200" fill="#ff7043" opacity="0.7"/>
                    
                    <!-- 视口指示器 -->
                    <rect class="minimap-viewport" id="minimapViewport" x="0" y="0" width="100" height="100"/>
                </svg>
            </div>

            <!-- 控制面板 -->
            <div class="control-panel">
                <button class="control-btn" onclick="zoomIn()" title="放大 (滚轮向上)">+</button>
                <button class="control-btn" onclick="zoomOut()" title="缩小 (滚轮向下)">−</button>
                <button class="control-btn" onclick="resetView()" title="重置视图">⟲</button>
                <button class="control-btn" onclick="fitToScreen()" title="适应屏幕">⛶</button>
            </div>
        </div>
    </div>

    <!-- 悬浮提示 -->
    <div id="tooltip" class="tooltip">
        <div class="room-id"></div>
        <div class="room-info"></div>
    </div>

    <!-- 详情弹窗 -->
    <div id="modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="modalTitle">房间详情</h2>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="info-grid" id="modalInfo"></div>
            </div>
        </div>
    </div>

    <script>
        // ==================== 数据定义 ====================
        const roomData = {
            'S-001': { name: '办公室A', type: '办公室', area: '45㎡', capacity: '8人', department: '技术部', equipment: '电脑×8, 打印机×2', status: '✅ 使用中', manager: '张三' },
            'S-002': { name: '办公室B', type: '办公室', area: '45㎡', capacity: '8人', department: '设计部', equipment: '电脑×8, 绘图板×4', status: '✅ 使用中', manager: '李四' },
            'S-003': { name: '办公室C', type: '办公室', area: '45㎡', capacity: '8人', department: '市场部', equipment: '电脑×8, 电话×8', status: '✅ 使用中', manager: '王五' },
            'S-010': { name: '大会议室', type: '会议室', area: '100㎡', capacity: '30人', equipment: '4K投影仪, 音响系统, 视频会议, 白板', status: '🟢 空闲', booking: '16:00-18:00 可预订' },
            'S-011': { name: '小会议室', type: '会议室', area: '45㎡', capacity: '10人', equipment: '65寸电视, 白板', status: '🔴 使用中', booking: '当前: 产品讨论会' },
            'S-020': { name: '茶水间', type: '功能区', area: '28㎡', equipment: '咖啡机×2, 微波炉×2, 冰箱, 饮水机×3', status: '🟢 开放', hours: '24小时开放' },
            'S-021': { name: '卫生间', type: '功能区', area: '21㎡', facilities: '男卫×3, 女卫×3', status: '✅ 正常', cleaning: '每日清洁 4次' },
            'S-030': { name: '设备机房', type: '设备区', area: '66.6㎡', equipment: '服务器×12, UPS, 精密空调', status: '⚡ 运行中', access: '🔒 需授权', temperature: '20°C', humidity: '45%' },
            'S-100': { name: '休息区', type: '公共区域', area: '42.5㎡', facilities: '沙发, 茶几×3, 书架, 绿植×8', status: '🟢 开放', hours: '8:00-20:00', amenities: '咖啡, 茶点, 杂志' },
            'S-201': { name: '开放办公区', type: '办公室', area: '46㎡', capacity: '12人', department: '运营部', equipment: '工位×12, 储物柜×12', status: '✅ 使用中' },
            'S-202': { name: '财务部', type: '办公室', area: '46㎡', capacity: '6人', department: '财务部', equipment: '电脑×6, 保险柜×2, 打印机', status: '✅ 使用中', access: '🔒 限制访问' },
            'S-203': { name: '培训室', type: '会议室', area: '58㎡', capacity: '40人', equipment: '投影仪, 音响, 课桌椅×40', status: '🟢 空闲', booking: '明日: 新员工培训' },
            'S-204': { name: '总经理办公室', type: '办公室', area: '74㎡', facilities: '办公桌, 会客区, 书柜, 休息区', equipment: '电脑, 电话, 保险柜, 咖啡机', status: '✅ 使用中', access: '🔒 预约访问' }
        };

        // ==================== 缩放和平移功能 ====================
        const viewport = document.getElementById('viewport');
        const svg = document.getElementById('floorplan');
        const zoomInfo = document.getElementById('zoomInfo');
        
        let scale = 1;
        let translateX = 0;
        let translateY = 0;
        let isDragging = false;
        let startX, startY;
        
        const MIN_SCALE = 0.3;
        const MAX_SCALE = 5;
        const ZOOM_SPEED = 0.1;

        // 更新SVG变换
        function updateTransform() {
            svg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
            zoomInfo.textContent = Math.round(scale * 100) + '%';
            updateMinimap();
        }

        // 鼠标滚轮缩放
        viewport.addEventListener('wheel', (e) => {
            e.preventDefault();
            
            const rect = viewport.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            // 计算鼠标在SVG中的位置
            const svgX = (mouseX - translateX) / scale;
            const svgY = (mouseY - translateY) / scale;
            
            // 缩放
            const delta = e.deltaY > 0 ? -ZOOM_SPEED : ZOOM_SPEED;
            const newScale = Math.min(Math.max(scale + delta, MIN_SCALE), MAX_SCALE);
            
            if (newScale !== scale) {
                // 调整平移以保持鼠标位置
                translateX = mouseX - svgX * newScale;
                translateY = mouseY - svgY * newScale;
                scale = newScale;
                updateTransform();
            }
        }, { passive: false });

        // 拖拽平移
        viewport.addEventListener('mousedown', (e) => {
            if (e.target.closest('.room')) return; // 不影响房间点击
            isDragging = true;
            startX = e.clientX - translateX;
            startY = e.clientY - translateY;
            viewport.classList.add('dragging');
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            translateX = e.clientX - startX;
            translateY = e.clientY - startY;
            updateTransform();
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            viewport.classList.remove('dragging');
        });

        // 双击放大
        viewport.addEventListener('dblclick', (e) => {
            if (e.target.closest('.room')) return;
            
            const rect = viewport.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            const svgX = (mouseX - translateX) / scale;
            const svgY = (mouseY - translateY) / scale;
            
            const targetScale = scale < 2 ? 2.5 : 1;
            animateZoom(scale, targetScale, svgX, svgY, mouseX, mouseY);
        });

        // 平滑缩放动画
        function animateZoom(fromScale, toScale, svgX, svgY, mouseX, mouseY) {
            const duration = 300;
            const startTime = performance.now();
            const startTransX = translateX;
            const startTransY = translateY;
            
            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeProgress = 1 - Math.pow(1 - progress, 3); // easeOut cubic
                
                scale = fromScale + (toScale - fromScale) * easeProgress;
                translateX = mouseX - svgX * scale;
                translateY = mouseY - svgY * scale;
                
                updateTransform();
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            requestAnimationFrame(animate);
        }

        // 控制按钮
        function zoomIn() {
            const rect = viewport.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const svgX = (centerX - translateX) / scale;
            const svgY = (centerY - translateY) / scale;
            
            const newScale = Math.min(scale + 0.3, MAX_SCALE);
            animateZoom(scale, newScale, svgX, svgY, centerX, centerY);
        }

        function zoomOut() {
            const rect = viewport.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const svgX = (centerX - translateX) / scale;
            const svgY = (centerY - translateY) / scale;
            
            const newScale = Math.max(scale - 0.3, MIN_SCALE);
            animateZoom(scale, newScale, svgX, svgY, centerX, centerY);
        }

        function resetView() {
            animateZoom(scale, 1, 700, 450, viewport.offsetWidth / 2, viewport.offsetHeight / 2);
        }

        function fitToScreen() {
            const rect = viewport.getBoundingClientRect();
            const svgWidth = 1400;
            const svgHeight = 900;
            const scaleX = rect.width / svgWidth;
            const scaleY = rect.height / svgHeight;
            const newScale = Math.min(scaleX, scaleY) * 0.95;
            
            translateX = (rect.width - svgWidth * newScale) / 2;
            translateY = (rect.height - svgHeight * newScale) / 2;
            
            animateZoom(scale, newScale, 700, 450, rect.width / 2, rect.height / 2);
        }

        // ==================== 小地图 ====================
        function updateMinimap() {
            const viewport = document.getElementById('viewport');
            const rect = viewport.getBoundingClientRect();
            const minimapRect = document.getElementById('minimapViewport');
            
            const viewX = -translateX / scale;
            const viewY = -translateY / scale;
            const viewW = rect.width / scale;
            const viewH = rect.height / scale;
            
            minimapRect.setAttribute('x', Math.max(0, viewX));
            minimapRect.setAttribute('y', Math.max(0, viewY));
            minimapRect.setAttribute('width', Math.min(1400, viewW));
            minimapRect.setAttribute('height', Math.min(900, viewH));
        }

        // ==================== 房间交互 ====================
        const rooms = document.querySelectorAll('.room');
        const tooltip = document.getElementById('tooltip');

        rooms.forEach(room => {
            room.addEventListener('mouseenter', function(e) {
                const roomId = this.getAttribute('data-room');
                const data = roomData[roomId];
                tooltip.querySelector('.room-id').textContent = roomId;
                tooltip.querySelector('.room-info').textContent = `${data.name} | ${data.type} | ${data.area}`;
                tooltip.classList.add('show');
            });

            room.addEventListener('mousemove', function(e) {
                tooltip.style.left = (e.clientX + 20) + 'px';
                tooltip.style.top = (e.clientY + 20) + 'px';
            });

            room.addEventListener('mouseleave', function() {
                tooltip.classList.remove('show');
            });
        });

        // 显示详情
        function showRoomDetail(roomId) {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modalTitle');
            const modalInfo = document.getElementById('modalInfo');
            const data = roomData[roomId];
            
            modalTitle.textContent = `${roomId} - ${data.name}`;
            
            let infoHTML = '';
            const labels = {
                'type': '类型', 'area': '面积', 'capacity': '容纳人数', 'department': '所属部门',
                'equipment': '设备配置', 'facilities': '设施', 'status': '当前状态', 'manager': '负责人',
                'booking': '预订信息', 'hours': '开放时间', 'cleaning': '清洁频率', 'access': '访问权限',
                'temperature': '温度', 'humidity': '湿度', 'amenities': '配套设施'
            };
            
            for (let key in data) {
                if (key !== 'name' && labels[key]) {
                    infoHTML += `
                        <div class="info-item">
                            <div class="info-label">${labels[key]}</div>
                            <div class="info-value">${data[key]}</div>
                        </div>`;
                }
            }
            
            modalInfo.innerHTML = infoHTML;
            modal.classList.add('show');
        }

        function closeModal(event) {
            document.getElementById('modal').classList.remove('show');
        }

        // 搜索和定位
        function searchRoom(event) {
            if (event.key === 'Enter') performSearch();
        }

        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!searchTerm) return;
            
            for (let roomId in roomData) {
                const data = roomData[roomId];
                if (roomId.toLowerCase().includes(searchTerm) || 
                    data.name.toLowerCase().includes(searchTerm) ||
                    (data.department && data.department.toLowerCase().includes(searchTerm))) {
                    locateRoom(roomId);
                    return;
                }
            }
            alert('❌ 未找到匹配的房间');
        }

        function locateRoom(roomId) {
            document.querySelectorAll('.room.highlight').forEach(r => r.classList.remove('highlight'));
            const targetRoom = document.querySelector(`.room[data-room="${roomId}"]`);
            if (targetRoom) {
                targetRoom.classList.add('highlight');
                setTimeout(() => targetRoom.classList.remove('highlight'), 3000);
                
                // 自动平移到房间
                const rect = targetRoom.getBoundingClientRect();
                const viewportRect = viewport.getBoundingClientRect();
                const roomCenterX = rect.left + rect.width / 2 - viewportRect.left;
                const roomCenterY = rect.top + rect.height / 2 - viewportRect.top;
                const viewportCenterX = viewportRect.width / 2;
                const viewportCenterY = viewportRect.height / 2;
                
                translateX += (viewportCenterX - roomCenterX);
                translateY += (viewportCenterY - roomCenterY);
                updateTransform();
            }
        }

        // 帮助面板
        function toggleHelp() {
            const helpPanel = document.getElementById('helpPanel');
            const showBtn = document.getElementById('showHelpBtn');
            if (helpPanel.style.display === 'none') {
                helpPanel.style.display = 'block';
                showBtn.style.display = 'none';
            } else {
                helpPanel.style.display = 'none';
                showBtn.style.display = 'block';
            }
        }

        // 键盘快捷键
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
            else if (e.key === '+' || e.key === '=') zoomIn();
            else if (e.key === '-') zoomOut();
            else if (e.key === '0') resetView();
            else if (e.key === 'f' || e.key === 'F') fitToScreen();
        });

        // 初始化
        window.addEventListener('load', () => {
            fitToScreen();
            setTimeout(() => {
                console.log('🎉 智能平面图系统已就绪！');
                console.log('💡 操作提示:');
                console.log('   🖱️  滚轮 - 缩放');
                console.log('   🖱️  拖拽 - 平移');
                console.log('   🖱️  双击 - 快速缩放');
                console.log('   ⌨️  +/- - 缩放');
                console.log('   ⌨️  F   - 适应屏幕');
                console.log('   ⌨️  ESC - 关闭弹窗');
            }, 500);
        });
    </script>
</body>
</html>

